\section{Einleitung}

Worum gehts? Firewall Geschichte? Theorie und Technisches über iptables (extra Kapitel)
Die Einleitung \cite{iptables}

vpn server liegt auf fw2. client to lan erlauben. 1194 1195 müssen weitergeleitet werden. für welche dev müssen wir die vpn freigeben?

alles was von innen nach außen aufgebaut wird, soll erlaub werden.

route muss in srv1 ins fw2 netzwerk eingetragen werden

\subsection{Begriffsdefinitionen}

Masquarading? Hier oder im Konfig Kapitel?

Connection Tracking? Hier oder im Konfig Kapitel?

\paragraph{DMZ}
Wenn als Computernetzwerkbegriff verstanden ist die
\emph{demilitarisierte Zone} ein Bereich in dem Dienste einer Firma die nach Außen,
also z.B. das Internet oder Extranet, angeboten werden. Diese Dienste sollen
vom eigentelichen LAN in einem abgeschotteten Bereich laufen, so dass
beispielsweise die Mitarbeiterrechner sicher sind.


\section{Versuchsaufbau}

Ziel ist es das Firmen-LAN sowie die zugehörige DMZ durch die
{\tt iptables} Linux-Firewall abzusichern.

\begin{figure}[h!]
  \centering
    \includegraphics[width=0.9\textwidth]{figures/Netzplan.jpg}
  \caption{Netzplan des Versuchsaufbaus.\cite{labor}}
  \label{fig.netzplan}
\end{figure}

Dazu sind im Versuchsaufbau für jeden der in Abbildung 
\ref{fig.netzplan} abgebildeten Rechner
eine virtuelle Maschine bereitgestellt --- dies ermöglicht leichteres
Testen.

Wir haben uns dazu entschieden, das Netzwerk der \emph{Firma A} aufzubauen.
Firma B bleibt unangetastet, und ist somit vollständig vorkonfiguriert,
was ebenfalls ein leichteres Testen ermöglicht.\cite{labor}


\section{Linux Konfiguration}

Zunächst müssen zwei Debian 6.0 Maschinen,
mit der minimalen Installation, eingerichtet werden.
Diese repräsentieren die Firewallmaschinen {\tt fw1} und {\tt fw2} von
\emph{Firma A} aus Abbildung \ref{fig.netzplan}.
Zum Einrichten und Testen der Firewall-Rechner wurde noch weitere Software
installiert, welche in Kapitel \ref{sec.software} aufgelistet ist.
Die genaue Konfiguration der einzelnen Netzwerkadapter ist in Kapitel
\ref{sec.netzwerk} beschrieben.

\subsection{Software}\label{sec.software}

In der Debian-Installation sind die Befehle {\tt iptables} und {\tt route}
standardmäßig verfügbar.
Mit {\tt iptables} lassen sich IPv4-Pakete filtern und Network Address
Translations (kurz NAT) durchführen.
Der Befehl {\tt route} dient zum Ändern der IP-Routing-Tabellen des Kernels um
beispielsweise statische Routen für bestimmte Rechner oder Netzwerke
festzulegen.

Folgende zusätzliche Software wurde via {\tt apt-get}, Debians Paketmanager,
installiert:

\begin{itemize}
    \item iptstate --- IPTables State Top.\\
        Zeigt Informationen über die IP Tables state table an (siehe Kap.
        \ref{sec.tests}).
    \item resolvconf --- Nameserver information handler.\\
        Erlaubt es, die DNS-Nameserver in der Datei
        {\tt /etc/network/interfaces}
        per {\tt dns-nameservers 1.2.3.4 5.6.7.8} zu definieren und
        generiert daraus die benötigten Einträge in der {\tt /etc/resolv.conf}
        (siehe Listings \ref{lst:fw1:eth0} \& \ref{lst:fw2:eth1}).
    \item mcedit --- Internal file editor of GNU Midnight Commander.\\
        Text-Editor für die Konsole, welcher neben Aktionen wie Kopieren,
        Ausschneiden und Einfügen auch Syntax-Highlighting für eine Vielzahl von
        Dateitypen bietet. Hierfür muss der GNU Midnight Commander mittels des
        Pakets {\tt mc} installiert werden.
\end{itemize}


\subsection{Netzwerkadapter}\label{sec.netzwerk}

Die Netzweradapter wurden gemäß der in Abbildung \ref{fig.netzplan}
gezeigten IP-Adressen konfiguriert, dies geschieht über die Datei
{\tt /etc/network/interfaces}.

\subsubsection{\fwa}

Ist Firewall {\tt fw1} die zwischen \fwa sitzt.

\paragraph{eth0} Verbindung zur DMZ.

\begin{lstlisting}[label=lst:fw1:eth0,caption={Netzwerkadapter eth0 Konfiguration.}]
allow-hotplug eth0
iface eth0 inet static
    address 192.168.40.250
    netmask 255.255.255.0
    broadcast 192.168.40.255
    dns-nameservers 192.168.40.1
    dns-search firma-a.f223
\end{lstlisting}

\paragraph{eth1} Verbindung zum Extranet bzw. Internet.

\begin{lstlisting}[label=lst:fw1:eth1,caption={Netzwerkadapter eth1 Konfiguration.}]
allow-hotplug eth1
iface eth1 inet static
    address 10.1.0.131
    netmask 255.255.255.0
    broadcast 10.1.0.0
\end{lstlisting}


\subsubsection{\fwb}

Ist Firewall {\tt fw2} die zwischen \fwb sitzt.

\paragraph{eth0} Verbindung zum Intranet.

\begin{lstlisting}[label=lst:fw2:eth0,caption={Netzwerkadapter eth0 Konfiguration.}]
allow-hotplug eth0
iface eth0 inet static
    address 192.168.30.240
    netmask 255.255.255.0
    network 192.168.30.0
    broadcast 192.168.30.255
    dns-search firma-a.f223
\end{lstlisting}

\paragraph{eth1} Verbindung zur DMZ.

\begin{lstlisting}[label=lst:fw2:eth1,caption={Netzwerkadapter eth1 Konfiguration.}]
allow-hotplug eth1
iface eth1 inet static
    address 192.168.40.240
    netmask 255.255.255.0
    network 192.168.40.0
    broadcast 192.168.40.255
    dns-nameservers 192.168.40.1
\end{lstlisting}


\subsection{Nützliches}

\subsubsection{Einfacher Dateitransfer}

Um auf einfache Weise eine Datei von einem Rechner auf einen anderen zu
kopieren, ohne beispielsweise einen Telnet-, FTP- oder SSH-Server aufsetzen zu
müssen, bietet sich das Programm {\tt Netcat} an.
{\tt Netcat} erlaubt es als "`TCP/IP swiss army knife"'
server- und client-seitig Daten von der Standardein- oder -ausgabe über
Netzwerkverbindungen zu transportieren.\\

\noindent Empfänger:
\begin{verbatim}
fw2 $ netcat -l -p 8080 > firewall-internal.sh
\end{verbatim}

\noindent Sender:
\begin{verbatim}
fw1 $ cat firewall-external.sh | netcat 192.168.40.240 8080
\end{verbatim}


\subsection{Bootskript}

Debian verwendet das sogenannte \emph{Init Script LSB}\footnote{
\url{http://wiki.debian.org/LSBInitScripts}}, welches Unterstützung
für \emph{dependency based boot sequencing}\footnote{
\url{http://wiki.debian.org/LSBInitScripts/DependencyBasedBoot}
} bietet. Das bedeutet, dass
die Programme die beim Aufstarten des Betriebssystems in einer idealen
Reihenfolge angeordnet werden, so dass es auch keine unangenehme Effekte
durch Abhängigkeiten der Programme untereinander entstehen.

Diese Bootskripte werden in {\tt /etc/init.d/} als Konfigurationsdateien
abgelegt und beginnen mit wohldefinierten Kopfzeilen, wie in Listing
\ref{lst:lsb-header} gezeigt. In diesen Zeilen können die Abhängigkeiten
konfiguriert werden.

\begin{lstlisting}[label=lst:lsb-header,caption={Init Script LSB: Kopfzeilen.}]
### BEGIN INIT INFO
# Provides:          scriptname
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start daemon at boot time
# Description:       Enable service provided by daemon.
### END INIT INFO
\end{lstlisting}

% TODO (MB): Beschreibung der Linux-Runlevels
% Achtung bei Debian wird auch bei 2 Netzwerk gestartet
% Angabe der gewählten Runlevel und Beschreibung der Abhängigkeiten

Das Programm {\tt insserv}\footnote{
\emph{Vor} Debian 6.0 wird {\tt update-rc.d} verwendet.
} aktiviert installierte Init-Skripte, in dem es die passenden symbolischen
Links in den Runlevel-Verzeichnissen ({\tt /etc/init.d/rcX.d}) setzt:

\begin{verbatim}
insserv my_init_script
\end{verbatim}

Nach den Kopfzeilen kommt das eigentliche Skript, welches z.B. mittels
{\tt iptables} die Firewall konfiguriert, aber auch beliebige andere Programme
und Dienste können somit gestartet werden.

\begin{lstlisting}[label=lst:lsb-script,caption={Init Script LSB: Eigentliches Skript.}]
case "$1" in
    start)
        # Startup stuff
        echo "Daemon started."
        ;;
    stop)
        # Shutdown this service
        echo "Daemon stopped."
        ;;
    restart)
        # Restart this service
        echo "Daemon restarted."
        ;;
    *)
        # The default case
        echo "Usage $0 {start|stop|restart}"
        ;;
esac
\end{lstlisting}


\section{Anforderungen}

\subsection{\fwa}

\paragraph{§ 1 Anforderungsname}

\subsection{\fwb}

